# Workscope-20260118-170544

## Workscope ID
20260118-170544

## Navigation Path
1. `docs/core/Action-Plan.md` (Phase 4, item 4.2)
2. `docs/features/collect-trials-script/Collect-Trials-Script-Overview.md`

## Phase Inventory (Terminal Checkboxlist)

**Document:** `docs/features/collect-trials-script/Collect-Trials-Script-Overview.md`

```
PHASE INVENTORY FOR Collect-Trials-Script-Overview.md:
Phase 0: CLEAR
Phase 1: CLEAR
Phase 2: CLEAR
Phase 3: CLEAR
Phase 4: 4.2 - Implement batch collection loop
Phase 5: 5.1 - Implement progress output
Phase 6: 6.1 - Implement comprehensive integration tests
Phase 7: 7.1 - Update `docs/core/Experiment-Methodology-02.md`

FIRST AVAILABLE PHASE: Phase 4
FIRST AVAILABLE ITEM: 4.2 - Implement batch collection loop
```

## Selected Tasks

**Phase 4: Trial Collection**

- [ ] **4.2** - Implement batch collection loop
  - [ ] **4.2.1** - Iterate over all scanned exports
  - [ ] **4.2.2** - Track collected, skipped, and failed counts
  - [ ] **4.2.3** - Continue processing on individual trial errors
- [ ] **4.3** - Implement Phase 4 tests
  - [ ] **4.3.1** - Create `flat_session_structure`, `hybrid_session_structure`, `hierarchical_session_structure` fixtures
  - [ ] **4.3.2** - Implement `TestCopySessionFiles` class (6 tests: flat, hybrid, hierarchical, agent matching, no subdirectory, no root agents)
  - [ ] **4.3.3** - Implement `TestCollectSingleTrial` class (6 tests: success, directory creation, file naming, export deletion, skip existing)
  - [ ] **4.3.4** - Implement `TestIdempotency` class (3 tests: re-run skips, export cleanup, partial recovery)

**Total Leaf Tasks**: 7

## Phase 0 Status (Root Action Plan)

**Status**: CLEAR

No Phase 0 items remain in the root Action Plan.

## Context Documents

**Primary Context:**
- `docs/core/Action-Plan.md`
- `docs/features/collect-trials-script/Collect-Trials-Script-Overview.md`

**Related Documentation:**
- `docs/core/PRD.md`
- `docs/core/Experiment-Methodology-02.md`
- `docs/read-only/Agent-Rules.md`

**Implementation Files:**
- `src/collect_trials.py`
- `tests/test_collect_trials.py`

## Directive

None provided.

## Work Description

This workscope completes Phase 4 of the Collect Trials Script implementation by adding the batch collection orchestration logic and comprehensive tests. The work includes:

1. **Batch Collection Loop** (4.2): Implement the main orchestration logic that iterates over all scanned exports, calls the single-trial collection function for each, tracks success/skip/failure counts, and continues processing even when individual trials fail.

2. **Phase 4 Tests** (4.3): Create comprehensive test coverage for the trial collection functionality, including fixtures for all three session structure types (flat, hybrid, hierarchical), tests for the session file copying algorithm, tests for single trial collection orchestration, and tests for idempotency guarantees.

This workscope follows the phase-aligned testing approach defined in the specification, where tests are written alongside implementation to maintain fresh context and ensure each phase ends with passing tests.
