# Workscope-20260118-155918

## Workscope ID
20260118-155918

## Navigation Path
1. `docs/core/Action-Plan.md` (Phase 4, item 4.2)
2. `docs/features/collect-trials-script/Collect-Trials-Script-Overview.md` (Phase 4, item 4.1)

## Phase Inventory (Terminal Checkboxlist)

**Document:** `docs/features/collect-trials-script/Collect-Trials-Script-Overview.md`

```
PHASE INVENTORY FOR Collect-Trials-Script-Overview.md:
Phase 1: CLEAR
Phase 2: CLEAR
Phase 3: CLEAR
Phase 4: 4.1 - Implement single trial collection using unified algorithm
Phase 5: 5.1 - Implement progress output
Phase 6: 6.1 - Implement comprehensive integration tests
Phase 7: 7.1 - Update `docs/core/Experiment-Methodology-02.md`

FIRST AVAILABLE PHASE: Phase 4
FIRST AVAILABLE ITEM: 4.1 - Implement single trial collection using unified algorithm
```

## Selected Tasks

**Phase 4: Trial Collection**

- [ ] **4.1** - Implement single trial collection using unified algorithm
  - [ ] **4.1.1** - Create trial directory `{destination}/{WORKSCOPE_ID}/`
  - [ ] **4.1.2** - Skip if trial directory already exists (idempotency)
  - [ ] **4.1.3** - Copy chat export as `{WORKSCOPE_ID}.txt`
  - [ ] **4.1.4** - Copy main session `.jsonl` file (preserve UUID filename)
  - [ ] **4.1.5** - Implement `copy_session_files()` with DI support for copy functions
  - [ ] **4.1.6** - Copy session subdirectory if it exists (handles tool-results/ and subagents/)
  - [ ] **4.1.7** - Search and copy root-level `agent-*.jsonl` files matching session UUID
  - [ ] **4.1.8** - Delete source export only after successful copy

**Total Leaf Tasks:** 8

## Phase 0 Status (Root Action Plan)

**Status:** CLEAR

Phase 0 in Action-Plan.md has no available items.

## Context Documents

**Primary Context:**
- `docs/core/Action-Plan.md`
- `docs/features/collect-trials-script/Collect-Trials-Script-Overview.md`

**Related Specifications:**
- `docs/core/PRD.md`
- `docs/core/Experiment-Methodology-02.md`

**Implementation Files:**
- `src/collect_trials.py`
- `tests/test_collect_trials.py`

**Related Scripts:**
- `src/archive_claude_sessions.py` (for `encode_project_path()` reuse)

## Directive

None provided.

## Work Description

This workscope implements the core trial collection functionality that processes individual trials by copying all associated files (chat export, session files, subagent logs, tool results) into organized trial directories. The work focuses on the unified algorithm that handles all three session structure types (flat, hybrid, hierarchical) transparently and includes idempotency mechanisms to prevent duplicate processing.

The implementation requires dependency injection support for file operations to enable testability while maintaining the core collection logic that creates trial directories, manages file copying across different session structures, and ensures safe export cleanup only after successful collection.
