# Workscope-20260129-163626

## Workscope ID
20260129-163626

## Navigation Path
Action-Plan.md â†’ upgrade-trial-data-schema-1-3.md

## Phase Inventory (Terminal Checkboxlist)
**Document:** docs/tickets/open/upgrade-trial-data-schema-1-3.md

Phase 0: N/A (no Phase 0 in this ticket)
Phase 1: CLEAR
Phase 2: CLEAR
Phase 3: 3.1 Enumerate tool-results files and extract tool IDs
Phase 4: 4.1 Compute initial_cache_read
Phase 5: 5.1 Update schema version to 1.3
Phase 6: 6.1 Update Trial-Analysis-Guide.md usage fields
Phase 7: 7.1 Run verification on FAILURE trial

**FIRST AVAILABLE PHASE:** Phase 3
**FIRST AVAILABLE ITEM:** 3.1 Enumerate tool-results files and extract tool IDs

## Selected Tasks
**Phase 3: Add Persistence Mapping**
- [ ] 3.1 - When tool-results/ directory exists, enumerate its files and extract tool IDs by stripping the .txt extension from each filename (expected format: {tool_use_id}.txt, e.g., toolu_01JqXDYnd3tmfuMbccjoUaFG.txt)
- [ ] 3.2 - Cross-reference persisted tool IDs against the file_reads entries (matching on tool_use_id) to build three lists: persisted_reads (persisted tool IDs that match a file_read), non_persisted_reads (file_reads whose tool_use_id is NOT in the persisted set), and persisted_non_reads (persisted tool IDs that do NOT match any file_read, e.g., Bash command results)
- [ ] 3.3 - Assemble the persistence_mapping section with persisted_tool_ids, persisted_count, non_persisted_count, persisted_reads, non_persisted_reads, and persisted_non_reads. Ensure accounting identity: persisted_count = len(persisted_reads) + len(persisted_non_reads)
- [ ] 3.4 - When has_tool_results is false or no session subdirectory exists, populate persistence_mapping with the empty structure: persisted_tool_ids: [], persisted_count: 0, persisted_non_reads: [], persisted_reads: [], and non_persisted_reads populated with ALL file_read entries (since none were persisted)

**Phase 4: Add Derived Top-Level Metrics**
- [ ] 4.1 - Compute initial_cache_read from the first token_progression entry's cache_read_tokens
- [ ] 4.2 - Compute total_input_at_peak as max(total_input) across all token_progression entries, and peak_cache_read as max(cache_read_tokens) (convenience alias for quick access)
- [ ] 4.3 - Add initial_cache_read, total_input_at_peak, and peak_cache_read to the context_metrics section of the output

## Phase 0 Status (Root Action Plan)
**Source:** docs/core/Action-Plan.md
**Status:** BLOCKING

Phase 0 has one available item:
- [ ] 0.4 - Update trial_data.json to Schema 1.3 (see docs/tickets/open/upgrade-trial-data-schema-1-3.md)

This workscope addresses the blocking Phase 0 item by implementing tasks from the linked ticket.

## Context Documents
1. **docs/core/Action-Plan.md** - Root checkboxlist, Phase 0 item 0.4
2. **docs/tickets/open/upgrade-trial-data-schema-1-3.md** - Terminal checkboxlist with implementation phases

## Directive
No directive provided. Default selection: 3-7 coherent items starting from first available item.

Selected 7 items (Phase 3 + Phase 4) representing persistence mapping implementation and derived metrics computation.
