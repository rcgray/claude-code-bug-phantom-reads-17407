# Workscope-20260129-161750

## Workscope ID
20260129-161750

## Navigation Path
1. `docs/core/Action-Plan.md` (Phase 0, item 0.4)
2. `docs/tickets/open/upgrade-trial-data-schema-1-3.md`

## Phase Inventory (Terminal Checkboxlist)

**Document:** `docs/tickets/open/upgrade-trial-data-schema-1-3.md`

```
PHASE INVENTORY FOR upgrade-trial-data-schema-1-3.md:
Phase 1: CLEAR
Phase 2: 2.1 - For each detected reset, look up the assistant message's full usage data at `session_line` and add `cache_creation_at_reset` and `total_input_at_reset` to the reset entry
Phase 3: 3.1 - When `tool-results/` directory exists, enumerate its files and extract tool IDs by stripping the `.txt` extension from each filename
Phase 4: 4.1 - Compute `initial_cache_read` from the first `token_progression` entry's `cache_read_tokens`
Phase 5: 5.1 - Update `schema_version` from `"1.2"` to `"1.3"` in the output assembly
Phase 6: 6.1 - Update `docs/experiments/guides/Trial-Analysis-Guide.md` Section 3.4 ("Key Data Points in Session Files") to document the newly extracted usage fields
Phase 7: 7.1 - Run the updated script on `dev/misc/barebones-2121/20260128-150640` (FAILURE, `has_tool_results: true`) and verify

FIRST AVAILABLE PHASE: Phase 2
FIRST AVAILABLE ITEM: 2.1 - For each detected reset, look up the assistant message's full usage data at `session_line` and add `cache_creation_at_reset` and `total_input_at_reset` to the reset entry
```

## Selected Tasks

**Phase 2: Enrich Reset Entries**

- [ ] **2.1** - For each detected reset, look up the assistant message's full usage data at `session_line` and add `cache_creation_at_reset` and `total_input_at_reset` to the reset entry. If no resets exist, this phase is a no-op (the `resets` array remains empty with no new fields needed)
- [ ] **2.2** - Compute `compaction_loss = from_tokens - (to_tokens + cache_creation_at_reset)` and add it to the reset entry. Positive values indicate tokens lost during reconstruction; negative values indicate post-reset expansion (typical in SUCCESS trials)

**Total Leaf Tasks**: 2

## Phase 0 Status (Root Action Plan)

**Status**: BLOCKING

Phase 0 item 0.4 is being executed through this workscope:
- 0.4 - Update `trial_data.json` to Schema 1.3 (see `docs/tickets/open/upgrade-trial-data-schema-1-3.md`)

## Context Documents

**Primary Context:**
- `docs/core/Action-Plan.md`
- `docs/tickets/open/upgrade-trial-data-schema-1-3.md`

**Implementation Files:**
- `dev/karpathy/extract_trial_data.py`

**Verification Data:**
- `dev/misc/barebones-2121/20260128-150640/trial_data.json`
- `dev/misc/repro-attempts-04-2120/20260127-095002/trial_data.json`

**Related Documentation:**
- `docs/experiments/results/Build-Scan-Discrepancy-Analysis.md`

## Directive

None provided.
